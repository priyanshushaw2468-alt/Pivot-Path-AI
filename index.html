<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PivotPath AI - Career Roadmap Generator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, .font-display {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* Screen Management */
        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .screen.active {
            display: flex;
            opacity: 1;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        .slide-in { animation: fadeIn 0.4s ease-out forwards; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Gauge Animation */
        .gauge-circle { transition: stroke-dashoffset 1s ease-in-out; }
        
        /* Loading Spinner */
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        .animate-spin-slow { animation: spin 3s linear infinite; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0"
  }
}
</script>
</head>
<body class="antialiased selection:bg-blue-100 selection:text-blue-900">

    <!-- =========================
         SCREEN: HOME
    ========================== -->
    <div id="screen-home" class="screen active min-h-screen flex-col relative overflow-hidden">
        <!-- Background Blobs -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[600px] bg-blue-100/50 rounded-full blur-3xl -z-10 opacity-60 mix-blend-multiply pointer-events-none"></div>
        <div class="absolute bottom-0 right-0 w-[600px] h-[500px] bg-indigo-100/50 rounded-full blur-3xl -z-10 opacity-50 mix-blend-multiply pointer-events-none"></div>

        <header class="p-6 md:p-8 flex justify-between items-center max-w-7xl mx-auto w-full">
            <div class="font-display font-bold text-2xl tracking-tight text-slate-900 flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center text-white font-serif shadow-lg">P</div>
                PivotPath AI
            </div>
            <nav class="hidden sm:flex gap-8 text-sm font-medium text-slate-600">
                <span class="cursor-pointer hover:text-blue-600">How it works</span>
                <span class="cursor-pointer hover:text-blue-600">Pricing</span>
            </nav>
        </header>

        <main class="flex-1 flex flex-col items-center justify-center text-center px-4 max-w-5xl mx-auto pb-20 mt-10 md:mt-0">
            <div class="fade-in">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 mb-8 rounded-full bg-white border border-slate-200 text-slate-600 text-xs font-semibold uppercase tracking-wider shadow-sm">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    AI-Powered Career Coach
                </div>
                
                <h1 class="text-5xl md:text-7xl font-bold text-slate-900 mb-8 tracking-tight leading-[1.1]">
                    Pivot your career with <br/>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600">intelligent precision.</span>
                </h1>
                
                <p class="text-lg md:text-xl text-slate-600 mb-12 max-w-2xl mx-auto leading-relaxed">
                    Don't just guess your next move. Upload your resume and let our AI build a data-driven bridge to your dream role.
                </p>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                    <button onclick="app.startWizard()" class="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-medium text-white transition-all duration-200 bg-slate-900 rounded-full hover:bg-slate-800 hover:scale-105 hover:shadow-xl hover:shadow-blue-500/20">
                        Build My Roadmap
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2 group-hover:translate-x-1 transition-transform"><path d="m9 18 6-6-6-6"/></svg>
                    </button>
                    <button onclick="app.viewSample()" class="px-8 py-4 text-lg font-medium text-slate-600 hover:text-slate-900 transition-colors bg-white/50 hover:bg-white rounded-full border border-transparent hover:border-slate-200 hover:shadow-sm">
                        View Sample
                    </button>
                </div>
            </div>

            <!-- Features Grid -->
            <div class="mt-20 w-full grid grid-cols-1 md:grid-cols-3 gap-6 text-left max-w-4xl fade-in" style="animation-delay: 200ms;">
                <div class="p-6 bg-white/60 backdrop-blur-sm rounded-2xl border border-slate-200/60 hover:border-blue-200 transition-all">
                    <div class="w-12 h-12 bg-white rounded-xl mb-4 flex items-center justify-center shadow-sm border border-slate-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
                    </div>
                    <h3 class="font-bold text-slate-900 mb-2 font-display">Identify Skill Gaps</h3>
                    <p class="text-slate-500 text-sm leading-relaxed">See exactly what you are missing for your target role.</p>
                </div>
                <div class="p-6 bg-white/60 backdrop-blur-sm rounded-2xl border border-slate-200/60 hover:border-blue-200 transition-all">
                    <div class="w-12 h-12 bg-white rounded-xl mb-4 flex items-center justify-center shadow-sm border border-slate-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-600"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 1-4 4v14a3 3 0 0 0 3-3h7z"/></svg>
                    </div>
                    <h3 class="font-bold text-slate-900 mb-2 font-display">Curated Resources</h3>
                    <p class="text-slate-500 text-sm leading-relaxed">Get specific courses, books, and projects to fill those gaps.</p>
                </div>
                <div class="p-6 bg-white/60 backdrop-blur-sm rounded-2xl border border-slate-200/60 hover:border-blue-200 transition-all">
                    <div class="w-12 h-12 bg-white rounded-xl mb-4 flex items-center justify-center shadow-sm border border-slate-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-600"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    </div>
                    <h3 class="font-bold text-slate-900 mb-2 font-display">Realistic Timeline</h3>
                    <p class="text-slate-500 text-sm leading-relaxed">A week-by-week plan tailored to your learning style.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- =========================
         SCREEN: WIZARD
    ========================== -->
    <div id="screen-wizard" class="screen min-h-screen items-center justify-center bg-white p-4 relative">
        <div class="absolute inset-0 bg-slate-50/50"></div>
        <!-- Progress Bar -->
        <div class="absolute top-0 left-0 w-full h-2 bg-slate-200 z-10">
            <div id="wizard-progress" class="bg-blue-600 h-full transition-all duration-500 ease-out" style="width: 20%"></div>
        </div>

        <div class="w-full max-w-2xl bg-white rounded-3xl shadow-xl shadow-slate-200/50 overflow-hidden relative z-20 border border-slate-100 min-h-[600px] flex flex-col">
            <!-- Header -->
            <div class="px-8 py-6 border-b border-slate-50 flex justify-between items-center bg-white/50 backdrop-blur-sm">
                <div class="flex items-center gap-2">
                    <span id="step-number" class="flex items-center justify-center w-8 h-8 rounded-full bg-slate-900 text-white text-xs font-bold">1</span>
                    <span id="step-label" class="text-sm font-bold text-slate-400 uppercase tracking-wider">/ 5 Resume</span>
                </div>
                <button onclick="app.showScreen('home')" class="text-xs font-medium text-slate-400 hover:text-slate-600">Cancel</button>
            </div>

            <!-- Dynamic Content -->
            <div id="wizard-content" class="flex-1 p-8 md:p-12 flex flex-col justify-center">
                <!-- Content injected via JS -->
            </div>

            <!-- Footer -->
            <div class="p-8 border-t border-slate-50 bg-slate-50/30 flex justify-between items-center">
                <button id="btn-back" onclick="app.prevStep()" class="flex items-center px-6 py-3 rounded-xl font-bold transition-colors text-slate-600 hover:bg-slate-100 hover:text-slate-900">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                    <span class="ml-2">Back</span>
                </button>
                <button id="btn-next" onclick="app.nextStep()" class="flex items-center bg-slate-900 hover:bg-slate-800 text-white px-8 py-4 rounded-xl shadow-lg shadow-slate-900/10 hover:shadow-xl transition-all transform hover:-translate-y-0.5 font-bold">
                    <span id="btn-next-text">Continue</span>
                    <svg id="btn-next-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- =========================
         SCREEN: PROCESSING
    ========================== -->
    <div id="screen-processing" class="screen min-h-screen bg-white flex-col items-center justify-center p-4">
        <div class="max-w-md w-full text-center space-y-10">
            <div class="relative w-32 h-32 mx-auto">
                <div class="absolute inset-0 border-4 border-slate-100 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-blue-600 rounded-full border-t-transparent animate-spin"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center animate-pulse">
                        <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
                    </div>
                </div>
            </div>
            
            <div class="space-y-2 h-16">
                <h2 id="processing-msg" class="text-2xl font-display font-bold text-slate-900 transition-opacity duration-300">Scanning resume...</h2>
                <p class="text-slate-500">Please wait while we engineer your career path.</p>
            </div>
            
            <button onclick="app.showScreen('wizard')" class="text-sm text-slate-400 hover:text-slate-600 font-medium underline transition-colors">Cancel</button>
        </div>
    </div>

    <!-- =========================
         SCREEN: RESULTS
    ========================== -->
    <div id="screen-results" class="screen min-h-screen bg-[#f8fafc] flex-col">
        <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-xl border-b border-slate-200 px-6 py-4 flex justify-between items-center shadow-sm">
            <div class="flex items-center gap-4">
                <button onclick="app.showScreen('wizard')" class="p-2 text-slate-500 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-serif text-sm">P</div>
                    <span class="font-display font-bold text-slate-800 hidden sm:inline">PivotPath AI</span>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="app.showScreen('export')" class="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 rounded-lg text-sm font-medium transition-all shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    <span class="hidden sm:inline">Export</span>
                </button>
            </div>
        </header>

        <div class="max-w-7xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8 w-full">
            <!-- Sidebar -->
            <div class="lg:col-span-4 space-y-6">
                <div class="lg:sticky lg:top-24 space-y-6">
                    <!-- Summary Card -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200/60 overflow-hidden relative group">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-blue-50 rounded-full -mr-16 -mt-16 bg-blue-50"></div>
                        <div class="relative">
                            <div class="inline-flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-700 text-[10px] font-bold uppercase tracking-wider rounded-md mb-3">Target Role</div>
                            <h2 id="res-target-role" class="text-2xl font-display font-bold text-slate-900 mb-1">...</h2>
                            <div id="res-target-industry" class="text-sm font-medium text-slate-400 mb-5">...</div>
                            <p id="res-summary" class="text-slate-600 text-sm leading-relaxed mb-6">...</p>
                            <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-100">
                                <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center text-slate-600 shadow-sm border border-slate-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                </div>
                                <div class="flex-1">
                                    <div class="text-xs text-slate-500 uppercase font-semibold">Estimated Time</div>
                                    <div id="res-time" class="text-sm font-bold text-slate-900">...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ATS Score Card -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200/60">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-2 font-display font-bold text-slate-800">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><circle cx="10" cy="13" r="2"/><path d="m11.5 14.5 2 2"/></svg>
                                <span>ATS Score</span>
                            </div>
                            <!-- Gauge Container -->
                            <div id="ats-gauge-container" class="relative flex items-center justify-center">
                                <!-- Injected via JS -->
                            </div>
                        </div>
                        <div class="space-y-5">
                            <div>
                                <div class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-3">Missing Keywords</div>
                                <div id="ats-keywords" class="flex flex-wrap gap-2"></div>
                            </div>
                            <div class="space-y-3">
                                <div class="text-xs font-bold text-slate-400 uppercase tracking-wide">Optimization Tips</div>
                                <div id="ats-tips" class="space-y-3"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Gap Analysis -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200/60">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-4">Skill Gap Analysis</div>
                        <ul id="gap-list" class="space-y-0 divide-y divide-slate-100"></ul>
                    </div>
                </div>
            </div>

            <!-- Main Timeline -->
            <div class="lg:col-span-8">
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200/60 p-6 md:p-8">
                    <div class="flex items-center justify-between mb-8">
                        <h3 class="text-2xl font-display font-bold text-slate-900 flex items-center gap-3">
                            <div class="p-2 bg-blue-100 text-blue-600 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
                            </div>
                            Your Strategic Roadmap
                        </h3>
                    </div>
                    <div id="timeline-container" class="relative ml-3 md:ml-4 space-y-12 before:absolute before:left-[19px] md:before:left-[27px] before:top-4 before:bottom-4 before:w-0.5 before:bg-slate-200">
                        <!-- Timeline items injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- =========================
         SCREEN: EXPORT
    ========================== -->
    <div id="screen-export" class="screen min-h-screen bg-slate-50 flex-col items-center justify-center p-4 relative overflow-hidden">
        <div class="absolute inset-0 bg-[radial-gradient(#e2e8f0_1px,transparent_1px)] [background-size:16px_16px] opacity-50"></div>
        <div class="bg-white p-8 md:p-12 rounded-3xl shadow-xl max-w-lg w-full text-center space-y-8 fade-in relative z-10 border border-slate-100">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-2xl flex items-center justify-center mx-auto shadow-sm transform rotate-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
            </div>
            <div>
                <h2 class="text-3xl font-display font-bold text-slate-900 mb-2">Roadmap Ready!</h2>
                <p class="text-slate-500">Your strategic career plan has been generated.</p>
            </div>
            <div class="grid gap-4">
                <button class="flex items-center justify-center gap-4 p-5 border border-slate-200 rounded-2xl hover:bg-slate-50 hover:border-blue-300 hover:shadow-md transition-all group bg-white">
                    <div class="p-3 bg-blue-100 text-blue-600 rounded-xl group-hover:bg-blue-600 group-hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    </div>
                    <div class="text-left flex-1">
                        <div class="font-bold text-slate-800 text-lg">Download PDF</div>
                        <div class="text-xs text-slate-400">High-quality format for printing</div>
                    </div>
                </button>
            </div>
            <div class="pt-8 border-t border-slate-100">
                <button onclick="app.showScreen('results')" class="text-slate-400 hover:text-slate-700 text-sm font-medium transition-colors">Back to Dashboard</button>
            </div>
        </div>
    </div>

    <!-- =========================
         SCREEN: ERROR
    ========================== -->
    <div id="screen-error" class="screen min-h-screen bg-slate-50 items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-xl border border-red-100 max-w-md text-center w-full">
            <div class="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
            </div>
            <h2 class="text-xl font-bold text-slate-900 mb-2">Generation Failed</h2>
            <p id="error-msg" class="text-slate-500 mb-8 text-sm leading-relaxed">Something went wrong.</p>
            <div class="space-y-3">
                <button onclick="app.generateRoadmap()" class="w-full bg-slate-900 text-white py-3 rounded-xl hover:bg-slate-800 transition-colors font-medium shadow-lg shadow-slate-200">Try Again</button>
                <button onclick="app.showScreen('home')" class="w-full bg-white text-slate-600 py-3 rounded-xl hover:bg-slate-50 border border-slate-200 transition-colors font-medium">Back to Start</button>
            </div>
        </div>
    </div>

    <!-- =========================
         JAVASCRIPT APPLICATION
    ========================== -->
    <script type="text/javascript">
        (function() {
            // --- CONFIGURATION ---
            // NOTE: Using the API Key provided by the user.
            const API_KEY = '0912cde5-9562-4740-a888-c77b7993fab5'; 
            
            // --- STATE ---
            const state = {
                step: 0,
                profile: {
                    resumeText: '',
                    resumeData: null, // { mimeType: '', data: 'base64...' }
                    resumeFileName: '',
                    currentRole: '',
                    targetRole: '',
                    targetIndustry: '',
                    topSkills: [],
                    learningStyle: 'Mixed'
                },
                roadmap: null
            };

            const STEPS_LABELS = ['Resume', 'Current Role', 'Pivot Goal', 'Skills', 'Style'];

            // --- SAMPLE DATA ---
            const SAMPLE_ROADMAP = {
                summary: "This roadmap leverages your background in Marketing to transition into UX Design. It capitalizes on your empathy and storytelling skills while building technical proficiency in Figma and research methodologies.",
                estimatedTotalTime: "4-5 Months",
                atsAnalysis: {
                    score: 45,
                    missingKeywords: ["Figma", "User Flows", "Wireframing", "Usability Testing"],
                    tips: ["Add a 'Projects' section", "List tools like Figma clearly", "Use standard headings like 'Experience'"]
                },
                gapAnalysis: ["User Research", "Prototyping", "Information Architecture"],
                timeline: [
                    {
                        title: "Foundations",
                        duration: "Month 1",
                        description: "Learn core UX principles.",
                        keyActions: ["Take Google UX Course", "Read 'Design of Everyday Things'"],
                        resources: [{ title: "Google UX Cert", type: "Course", url: "#" }]
                    },
                    {
                        title: "Technical Skills",
                        duration: "Month 2",
                        description: "Master Figma and prototyping.",
                        keyActions: ["Clone 3 apps in Figma", "Learn Auto-layout"],
                        resources: [{ title: "Figma 101", type: "Course", url: "#" }]
                    }
                ]
            };

            // --- APP LOGIC ---
            const app = {
                
                // Navigation
                showScreen: (screenId) => {
                    document.querySelectorAll('.screen').forEach(el => {
                        el.classList.remove('active');
                    });
                    const target = document.getElementById(`screen-${screenId}`);
                    if(target) target.classList.add('active');
                    window.scrollTo(0,0);
                },

                // Wizard
                startWizard: () => {
                    state.step = 0;
                    app.renderWizardStep();
                    app.showScreen('wizard');
                },

                nextStep: () => {
                    if (state.step < 4) {
                        state.step++;
                        app.renderWizardStep();
                    } else {
                        app.showScreen('processing');
                        app.startProcessingAnimation();
                        app.generateRoadmap();
                    }
                },

                prevStep: () => {
                    if (state.step > 0) {
                        state.step--;
                        app.renderWizardStep();
                    } else {
                        app.showScreen('home');
                    }
                },

                // Field Updates
                updateField: (field, value) => {
                    state.profile[field] = value;
                },

                handleFile: (input) => {
                    const file = input.files[0];
                    if (!file) return;

                    state.profile.resumeFileName = file.name;
                    const reader = new FileReader();

                    if (file.type.includes('image') || file.type.includes('pdf')) {
                        reader.onload = (e) => {
                            const base64 = e.target.result.split(',')[1];
                            state.profile.resumeData = { mimeType: file.type, data: base64 };
                            state.profile.resumeText = '';
                            app.renderWizardStep();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        reader.onload = (e) => {
                            state.profile.resumeText = e.target.result;
                            state.profile.resumeData = null;
                            app.renderWizardStep();
                        };
                        reader.readAsText(file);
                    }
                },

                removeFile: () => {
                    state.profile.resumeFileName = '';
                    state.profile.resumeData = null;
                    state.profile.resumeText = '';
                    app.renderWizardStep();
                },

                addSkill: () => {
                    const input = document.getElementById('skill-input');
                    const val = input.value.trim();
                    if (val) {
                        state.profile.topSkills.push(val);
                        input.value = '';
                        app.renderWizardStep();
                        setTimeout(() => {
                             const el = document.getElementById('skill-input');
                             if(el) el.focus();
                        }, 10);
                    }
                },

                removeSkill: (skill) => {
                    state.profile.topSkills = state.profile.topSkills.filter(s => s !== skill);
                    app.renderWizardStep();
                },

                setStyle: (style) => {
                    state.profile.learningStyle = style;
                    app.renderWizardStep();
                },

                // Render Wizard HTML
                renderWizardStep: () => {
                    const content = document.getElementById('wizard-content');
                    const stepNum = document.getElementById('step-number');
                    const stepLabel = document.getElementById('step-label');
                    const progBar = document.getElementById('wizard-progress');
                    const btnNextText = document.getElementById('btn-next-text');
                    const btnNextIcon = document.getElementById('btn-next-icon');

                    if(stepNum) stepNum.textContent = state.step + 1;
                    if(stepLabel) stepLabel.textContent = `/ 5 ${STEPS_LABELS[state.step]}`;
                    if(progBar) progBar.style.width = `${((state.step + 1) / 5) * 100}%`;

                    if (state.step === 4) {
                        if(btnNextText) btnNextText.textContent = "Generate Roadmap";
                        if(btnNextIcon) btnNextIcon.classList.add('hidden');
                    } else {
                        if(btnNextText) btnNextText.textContent = "Continue";
                        if(btnNextIcon) btnNextIcon.classList.remove('hidden');
                    }

                    let html = '';
                    const s = state.profile;

                    if (state.step === 0) {
                        html = `
                            <div class="slide-in space-y-6">
                                <h2 class="text-3xl font-bold font-display text-slate-900 text-center">Let's start with your background</h2>
                                ${s.resumeFileName ? `
                                    <div class="p-6 bg-blue-50 border border-blue-200 rounded-xl flex items-center justify-between">
                                        <div class="font-bold text-slate-700">${s.resumeFileName}</div>
                                        <button onclick="app.removeFile()" class="text-red-500 font-bold text-sm hover:underline">Remove</button>
                                    </div>
                                ` : `
                                    <div class="border-2 border-dashed border-slate-300 rounded-xl p-10 text-center relative hover:bg-slate-50 transition-colors group">
                                        <input type="file" onchange="app.handleFile(this)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept=".pdf,.txt,.jpg,.png">
                                        <div class="text-slate-500 font-medium group-hover:text-blue-500">Click to upload Resume (PDF/TXT/IMG)</div>
                                    </div>
                                    <textarea class="w-full h-32 p-4 border border-slate-200 rounded-xl text-sm" placeholder="Or paste resume text here..." oninput="app.updateField('resumeText', this.value)">${s.resumeText}</textarea>
                                `}
                            </div>
                        `;
                    } else if (state.step === 1) {
                        html = `
                            <div class="slide-in space-y-6 text-center">
                                <h2 class="text-3xl font-bold font-display text-slate-900">Current Role</h2>
                                <input type="text" class="w-full p-4 border border-slate-200 rounded-xl text-lg outline-none focus:border-blue-500" placeholder="e.g. Marketing Manager" value="${s.currentRole}" oninput="app.updateField('currentRole', this.value)">
                            </div>
                        `;
                    } else if (state.step === 2) {
                        html = `
                            <div class="slide-in space-y-6">
                                <h2 class="text-3xl font-bold font-display text-slate-900 text-center">Your Goal</h2>
                                <div class="space-y-4">
                                    <input type="text" class="w-full p-4 border border-slate-200 rounded-xl outline-none focus:border-blue-500" placeholder="Target Role (e.g. UX Designer)" value="${s.targetRole}" oninput="app.updateField('targetRole', this.value)">
                                    <input type="text" class="w-full p-4 border border-slate-200 rounded-xl outline-none focus:border-blue-500" placeholder="Target Industry (Optional)" value="${s.targetIndustry}" oninput="app.updateField('targetIndustry', this.value)">
                                </div>
                            </div>
                        `;
                    } else if (state.step === 3) {
                        html = `
                            <div class="slide-in space-y-6">
                                <h2 class="text-3xl font-bold font-display text-slate-900 text-center">Key Skills</h2>
                                <div class="flex gap-2">
                                    <input id="skill-input" type="text" class="flex-1 p-3 border border-slate-200 rounded-xl outline-none" placeholder="Add a skill..." onkeydown="if(event.key==='Enter') app.addSkill()">
                                    <button onclick="app.addSkill()" class="bg-slate-900 text-white px-4 rounded-xl">Add</button>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    ${s.topSkills.map(sk => `<span class="bg-slate-100 px-3 py-1 rounded-lg text-sm flex items-center gap-2">${sk} <button onclick="app.removeSkill('${sk}')" class="text-slate-400 hover:text-red-500 font-bold">×</button></span>`).join('')}
                                </div>
                            </div>
                        `;
                    } else if (state.step === 4) {
                        html = `
                            <div class="slide-in space-y-6">
                                <h2 class="text-3xl font-bold font-display text-slate-900 text-center">Learning Style</h2>
                                <div class="grid grid-cols-2 gap-4">
                                    ${['Visual','Hands-on','Reading','Mixed'].map(st => `
                                        <button onclick="app.setStyle('${st}')" class="p-4 border-2 rounded-xl font-bold ${s.learningStyle === st ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-200 hover:border-blue-200'}">${st}</button>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }

                    if(content) content.innerHTML = html;
                },

                // Animations
                startProcessingAnimation: () => {
                    const msgs = ["Scanning resume...", "Analyzing skill gaps...", "Building timeline...", "Finalizing..."];
                    let i = 0;
                    const el = document.getElementById('processing-msg');
                    window.procInterval = setInterval(() => {
                        i = (i + 1) % msgs.length;
                        if(el) el.textContent = msgs[i];
                    }, 1500);
                },

                // API Generation
                generateRoadmap: async () => {
                    // Prepare Data
                    const s = state.profile;
                    const prompt = `
                        Role: Expert Career Coach & ATS Specialist.
                        User: Current: ${s.currentRole}. Target: ${s.targetRole} in ${s.targetIndustry}.
                        Skills: ${s.topSkills.join(', ')}. Style: ${s.learningStyle}.
                        Resume Context: ${s.resumeText.substring(0, 5000)}

                        Task 1: Generate a career pivot roadmap (summary, gap analysis, timeline with resources).
                        Task 2: ATS Scan (Score 0-100, missing keywords, tips).

                        Return pure JSON with schema:
                        {
                          "summary": "string",
                          "estimatedTotalTime": "string",
                          "atsAnalysis": { "score": number, "missingKeywords": ["string"], "tips": ["string"] },
                          "gapAnalysis": ["string"],
                          "timeline": [ { "title": "string", "duration": "string", "description": "string", "keyActions": ["string"], "resources": [{ "title": "string", "type": "string", "url": "string" }] } ]
                        }
                    `;

                    const parts = [];
                    if (s.resumeData) {
                        parts.push({ inline_data: { mime_type: s.resumeData.mimeType, data: s.resumeData.data } });
                    }
                    parts.push({ text: prompt });

                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: parts }],
                                generationConfig: { response_mime_type: "application/json" }
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`API Error: ${response.status}`);
                        }

                        const data = await response.json();
                        if (data.candidates && data.candidates[0].content.parts[0].text) {
                            state.roadmap = JSON.parse(data.candidates[0].content.parts[0].text);
                            app.renderResults();
                            clearInterval(window.procInterval);
                            app.showScreen('results');
                        } else {
                            throw new Error("No data returned");
                        }
                    } catch (e) {
                        console.error(e);
                        clearInterval(window.procInterval);
                        const errEl = document.getElementById('error-msg');
                        if(errEl) errEl.textContent = "Failed to generate roadmap. Please check your API Key and connection.";
                        app.showScreen('error');
                    }
                },

                viewSample: () => {
                    state.profile.targetRole = "UX Designer";
                    state.profile.targetIndustry = "Tech";
                    state.roadmap = SAMPLE_ROADMAP;
                    app.renderResults();
                    app.showScreen('results');
                },

                // Results Rendering
                renderResults: () => {
                    const r = state.roadmap;
                    const p = state.profile;

                    // Text Fields
                    const setTxt = (id, txt) => {
                        const el = document.getElementById(id);
                        if(el) el.textContent = txt;
                    };
                    
                    setTxt('res-target-role', p.targetRole);
                    setTxt('res-target-industry', p.targetIndustry || 'General');
                    setTxt('res-summary', r.summary);
                    setTxt('res-time', r.estimatedTotalTime);

                    // ATS Gauge
                    const score = r.atsAnalysis.score;
                    const color = score > 75 ? 'text-green-500' : (score > 40 ? 'text-amber-500' : 'text-red-500');
                    const stroke = score > 75 ? '#22c55e' : (score > 40 ? '#f59e0b' : '#ef4444');
                    const dash = 2 * Math.PI * 24; // r=24
                    const offset = dash - (score / 100) * dash;
                    
                    const gaugeContainer = document.getElementById('ats-gauge-container');
                    if(gaugeContainer) {
                        gaugeContainer.innerHTML = `
                            <div class="relative w-20 h-20 flex items-center justify-center">
                                 <svg class="w-full h-full transform -rotate-90">
                                    <circle cx="40" cy="40" r="24" fill="none" stroke="#e2e8f0" stroke-width="6"></circle>
                                    <circle cx="40" cy="40" r="24" fill="none" stroke="${stroke}" stroke-width="6" stroke-dasharray="${dash}" stroke-dashoffset="${offset}" class="gauge-circle"></circle>
                                 </svg>
                                 <span class="absolute text-xl font-bold ${color}">${score}</span>
                            </div>
                        `;
                    }

                    // Keywords & Tips
                    const kwEl = document.getElementById('ats-keywords');
                    if(kwEl) kwEl.innerHTML = r.atsAnalysis.missingKeywords.map(k => `<span class="bg-red-50 text-red-600 px-2 py-1 rounded text-xs border border-red-100">${k}</span>`).join('');
                    
                    const tipEl = document.getElementById('ats-tips');
                    if(tipEl) tipEl.innerHTML = r.atsAnalysis.tips.map(t => `<div class="flex gap-2 text-sm text-slate-600"><span class="text-green-500">✓</span> ${t}</div>`).join('');

                    // Gaps
                    const gapEl = document.getElementById('gap-list');
                    if(gapEl) gapEl.innerHTML = r.gapAnalysis.map(g => `<li class="py-2 text-sm text-slate-700 flex gap-2"><div class="w-1.5 h-1.5 mt-1.5 rounded-full bg-amber-400 shrink-0"></div>${g}</li>`).join('');

                    // Timeline
                    const tlContainer = document.getElementById('timeline-container');
                    if(tlContainer) {
                        tlContainer.innerHTML = r.timeline.map((item, i) => `
                            <div class="relative pl-12 md:pl-16 slide-in" style="animation-delay: ${i*100}ms">
                                <div class="absolute left-0 md:left-2 top-0 w-10 h-10 md:w-14 md:h-14 rounded-full bg-white border-4 border-blue-50 text-blue-600 font-bold flex items-center justify-center shadow-sm z-10 text-sm md:text-base">${i+1}</div>
                                <div class="bg-slate-50/50 rounded-2xl p-6 border border-slate-200 hover:border-blue-200 transition-colors">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="text-lg font-bold text-slate-900">${item.title}</h4>
                                        <span class="text-xs font-bold bg-white border border-slate-200 px-2 py-1 rounded uppercase">${item.duration}</span>
                                    </div>
                                    <p class="text-slate-600 text-sm mb-4">${item.description}</p>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <div class="text-xs font-bold text-slate-400 uppercase mb-2">Actions</div>
                                            <ul class="space-y-1">${item.keyActions.map(a => `<li class="text-sm flex gap-2"><span class="text-blue-500">›</span>${a}</li>`).join('')}</ul>
                                        </div>
                                        <div class="bg-white p-3 rounded-lg border border-slate-100">
                                            <div class="text-xs font-bold text-slate-400 uppercase mb-2">Resources</div>
                                            <div class="space-y-2">
                                                ${item.resources.map(res => `
                                                    <a href="${res.url}" target="_blank" class="block text-sm text-blue-600 hover:underline truncate">
                                                        <span class="text-xs text-slate-400 mr-1">[${res.type}]</span> ${res.title}
                                                    </a>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            };

            // Expose app to global scope for HTML event handlers
            window.app = app;
        })();
    </script>
</body>
</html>